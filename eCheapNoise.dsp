//FAUST CODE FOR EN ECHO BY MANOURY//
//BY ALAIN BONARDI
//2022
//eCheapNoise
//
import("stdfaust.lib");

noiseTabNsamp = 512;
delMaxNsamp = 65536;

player(f0, mySamp, mySampNum) = thisPlayer with {
	//f0 is the playing frequency
	//mySamp the array of samples
	//mySampNum the number of samples
	zeroToOnePhase =  os.phasor(1, f0) : ma.decimal; 
	myIndex = zeroToOnePhase * float(mySampNum); 
	i1 = int(myIndex);
	i2 = (i1+1) % int(mySampNum);
	d = ma.decimal(myIndex);
	s1 = (mySamp, i1) : (+(1), _, _) : rdtable;
	s2 = (mySamp, i2) : (+(1), _, _) : rdtable;
	thisPlayer = s1 + d * (s2 - s1);
};

freq = hslider("freq", 10, 0.001, 10000, 0.001);

f1 = freq * 0.29999;
f2 = freq * 0.22321;
f3 = freq * 0.25361;
f4 = freq * 0.24344;

p1 = player(f1, noiseTab, noiseTabNsamp) <: (_, _);
p2 = player(f2, noiseTab, noiseTabNsamp) <: (_, _);
p3 = player(f3, noiseTab, noiseTabNsamp) <: (_, _);
p4 = player(f4, noiseTab, noiseTabNsamp) <: (_, _);

split = (_ <: (_, _));
split4 = (split, split, split, split);
per1(a, b, c, d, e, f, g, h) = (b, c, d, e, f, g, h, a);
per2(a, b, c, d, e, f, g, h) = (a, c, b, d, e, g, f, h);
per3(a, b, c, d, e, f, g, h) = (a, e, b, f, c, g, d, h);
interlace2(n) = si.bus(2*n) <: par(i, n, (ba.selector(i, 2*n), ba.selector(i+n, 2*n)));

envBlock = (p1, p2, p3, p4) : per1 : (*, *, *, *) : split4 : per2 : (+, -, +, -) : split4 : per3 : (+, -, +, -) ;

del1 = de.fdelay(delMaxNsamp, 0);
del2 = de.fdelay(delMaxNsamp, 25 * ma.SR / 1000.0);
del3 = de.fdelay(delMaxNsamp, 17.7 * ma.SR / 1000.0);
del4 = de.fdelay(delMaxNsamp, 9.3 * ma.SR / 1000.0);

process = (_ <: (del1, del2, del3, del4)), envBlock : interlace2(4) : (*, *, *, *);


noiseTab = waveform {
-0.006256104,
-0.044067383,
-0.076202393,
-0.101959229,
-0.120666504,
-0.131958008,
-0.135681152,
-0.131866455,
-0.120605469,
-0.102600098,
-0.078186035,
-0.048309326,
-0.013824463,
0.024353027,
0.065002441,
0.107147217,
0.149658203,
0.191436768,
0.231414795,
0.268737793,
0.302520752,
0.331970215,
0.356750488,
0.376251221,
0.390289307,
0.398742676,
0.401763916,
0.399475098,
0.392242432,
0.380554199,
0.364898682,
0.346038818,
0.324554443,
0.301239014,
0.276824951,
0.252044678,
0.227630615,
0.204193115,
0.182373047,
0.162689209,
0.145599365,
0.131408691,
0.120422363,
0.112762451,
0.10848999,
0.107574463,
0.110015869,
0.115447998,
0.123748779,
0.13458252,
0.147583008,
0.162353516,
0.178497314,
0.195587158,
0.213195801,
0.230865479,
0.248168945,
0.264862061,
0.280303955,
0.294372559,
0.306610107,
0.316894531,
0.324890137,
0.330352783,
0.333221436,
0.333343506,
0.330657959,
0.325073242,
0.316741943,
0.30569458,
0.291870117,
0.275726318,
0.257171631,
0.236633301,
0.214416504,
0.190734863,
0.166107178,
0.14074707,
0.115264893,
0.090026855,
0.065490723,
0.042236328,
0.020629883,
0.00112915,
-0.015777588,
-0.029754639,
-0.040435791,
-0.047515869,
-0.05078125,
-0.050079346,
-0.045349121,
-0.036529541,
-0.023803711,
-0.007293701,
0.012664795,
0.035766602,
0.06161499,
0.089691162,
0.119476318,
0.15032959,
0.181732178,
0.21295166,
0.243530273,
0.272705078,
0.300018311,
0.325012207,
0.347137451,
0.366088867,
0.381561279,
0.3934021,
0.401397705,
0.405609131,
0.406097412,
0.403076172,
0.396636963,
0.387176514,
0.375,
0.360412598,
0.343963623,
0.325927734,
0.306640625,
0.286621094,
0.266113281,
0.245361328,
0.22467041,
0.20413208,
0.183898926,
0.163970947,
0.144378662,
0.125061035,
0.105926514,
0.086700439,
0.067443848,
0.047851563,
0.027862549,
0.007324219,
-0.01373291,
-0.035461426,
-0.057739258,
-0.080444336,
-0.103363037,
-0.126220703,
-0.148651123,
-0.170318604,
-0.190643311,
-0.209106445,
-0.225189209,
-0.23828125,
-0.24786377,
-0.253417969,
-0.254425049,
-0.250518799,
-0.241485596,
-0.226989746,
-0.20703125,
-0.18170166,
-0.1512146,
-0.115905762,
-0.076324463,
-0.03302002,
0.013092041,
0.061309814,
0.110626221,
0.160064697,
0.208587646,
0.255157471,
0.298797607,
0.338592529,
0.373626709,
0.403198242,
0.426849365,
0.443939209,
0.454315186,
0.457855225,
0.454650879,
0.444976807,
0.429260254,
0.408050537,
0.382080078,
0.352203369,
0.319274902,
0.284240723,
0.248046875,
0.211608887,
0.175872803,
0.141601563,
0.109527588,
0.080169678,
0.054046631,
0.031341553,
0.012145996,
-0.003479004,
-0.015838623,
-0.025268555,
-0.032226563,
-0.03729248,
-0.041137695,
-0.044281006,
-0.047576904,
-0.051605225,
-0.056945801,
-0.064086914,
-0.073394775,
-0.085144043,
-0.099365234,
-0.115997314,
-0.134735107,
-0.155181885,
-0.176696777,
-0.198577881,
-0.219970703,
-0.239929199,
-0.257476807,
-0.271636963,
-0.281433105,
-0.286010742,
-0.284423828,
-0.276275635,
-0.260955811,
-0.238311768,
-0.208251953,
-0.171081543,
-0.127288818,
-0.077545166,
-0.022918701,
0.035430908,
0.096191406,
0.157806396,
0.218536377,
0.276916504,
0.331115723,
0.379516602,
0.420654297,
0.453125,
0.475799561,
0.487792969,
0.488464355,
0.477539063,
0.454986572,
0.421295166,
0.37713623,
0.323577881,
0.261871338,
0.193756104,
0.121002197,
0.045623779,
-0.030303955,
-0.104614258,
-0.175201416,
-0.239990234,
-0.297119141,
-0.344848633,
-0.381835938,
-0.406890869,
-0.419311523,
-0.418701172,
-0.405029297,
-0.378692627,
-0.340606689,
-0.291656494,
-0.23348999,
-0.167816162,
-0.096588135,
-0.021942139,
0.05380249,
0.128448486,
0.199645996,
0.265411377,
0.323638916,
0.372650146,
0.410888672,
0.437347412,
0.451263428,
0.452178955,
0.440155029,
0.415618896,
0.379272461,
0.332366943,
0.276275635,
0.21270752,
0.143676758,
0.071044922,
-0.002716064,
-0.075775146,
-0.145843506,
-0.210968018,
-0.269348145,
-0.319366455,
-0.359771729,
-0.389587402,
-0.408081055,
-0.41506958,
-0.410522461,
-0.394958496,
-0.369018555,
-0.33380127,
-0.290588379,
-0.240905762,
-0.186401367,
-0.128875732,
-0.070129395,
-0.011962891,
0.04385376,
0.095825195,
0.142425537,
0.1824646,
0.215087891,
0.239501953,
0.255310059,
0.262481689,
0.261138916,
0.25177002,
0.235107422,
0.211975098,
0.183532715,
0.151031494,
0.115783691,
0.079162598,
0.042449951,
0.007049561,
-0.025848389,
-0.055236816,
-0.080108643,
-0.099884033,
-0.113922119,
-0.12197876,
-0.124023438,
-0.120117188,
-0.110687256,
-0.096313477,
-0.077636719,
-0.055389404,
-0.030639648,
-0.004241943,
0.022705078,
0.049316406,
0.074645996,
0.097869873,
0.118103027,
0.134918213,
0.147766113,
0.15625,
0.160369873,
0.160003662,
0.155334473,
0.14654541,
0.134124756,
0.118499756,
0.100250244,
0.079956055,
0.058197021,
0.035644531,
0.0128479,
-0.009674072,
-0.031402588,
-0.052032471,
-0.07119751,
-0.088745117,
-0.104492188,
-0.118499756,
-0.130645752,
-0.141265869,
-0.150360107,
-0.158172607,
-0.164886475,
-0.17074585,
-0.17590332,
-0.180511475,
-0.184661865,
-0.188293457,
-0.191558838,
-0.194152832,
-0.195983887,
-0.196716309,
-0.196228027,
-0.193939209,
-0.18963623,
-0.182891846,
-0.173309326,
-0.160644531,
-0.144470215,
-0.124725342,
-0.101257324,
-0.074066162,
-0.043273926,
-0.009063721,
0.028045654,
0.067718506,
0.109283447,
0.152038574,
0.19519043,
0.237854004,
0.279144287,
0.31817627,
0.354003906,
0.385925293,
0.412994385,
0.434692383,
0.450408936,
0.45980835,
0.462615967,
0.458831787,
0.448547363,
0.432128906,
0.410003662,
0.3828125,
0.351348877,
0.316497803,
0.27923584,
0.240570068,
0.201599121,
0.163330078,
0.126831055,
0.09286499,
0.062408447,
0.03604126,
0.014404297,
-0.002227783,
-0.01373291,
-0.020080566,
-0.021484375,
-0.018280029,
-0.011138916,
-0.000518799,
0.012481689,
0.02722168,
0.042633057,
0.057800293,
0.071746826,
0.083526611,
0.092407227,
0.097503662,
0.098327637,
0.094390869,
0.085418701,
0.071258545,
0.052062988,
0.028015137,
-0.000549316,
-0.033111572,
-0.068847656,
-0.107208252,
-0.147247314,
-0.188171387,
-0.229003906,
-0.268981934,
-0.307281494,
-0.343139648,
-0.376068115,
-0.405395508,
-0.430877686,
-0.452270508,
-0.469482422,
-0.482574463,
-0.491790771,
-0.497467041,
-0.5,
-0.49987793,
-0.497741699,
-0.494140625,
-0.489654541,
-0.484863281,
-0.480316162,
-0.476287842,
-0.473266602,
-0.471374512,
-0.470672607,
-0.471160889,
-0.472625732,
-0.474731445,
-0.476989746,
-0.478912354,
-0.479888916,
-0.479217529,
-0.476226807,
-0.470153809,
-0.460418701,
-0.446350098,
-0.427490234,
-0.403442383,
-0.373962402,
-0.339019775,
-0.298583984,
-0.253082275,
-0.202850342,
-0.148681641,
-0.091217041,
-0.03137207,
0.029602051,
0.090759277,
0.150817871,
0.208618164,
0.262878418,
0.312438965,
0.356323242,
0.393432617,
0.423065186,
0.444671631,
0.457702637,
0.462005615,
0.457580566,
0.444702148,
0.423858643,
0.3956604,
0.360992432,
0.320861816,
0.276489258,
0.229064941,
0.179992676,
0.130554199,
0.08215332,
0.03616333};